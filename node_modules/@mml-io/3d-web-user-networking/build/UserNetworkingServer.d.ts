import { DeltaNetV01Connection } from "@mml-io/delta-net-server";
import { LegacyUserIdentity, LegacyCharacterDescription } from "./legacy/LegacyUserNetworkingMessages";
import { UserData } from "./UserData";
import { UserNetworkingLogger } from "./UserNetworkingLogger";
import { UserNetworkingServerError, CharacterDescription } from "./UserNetworkingMessages";
export type UserNetworkingServerClient = {
    socket: WebSocket;
    id: number;
    lastPong: number;
    authenticatedUser: UserData | null;
    deltaNetConnection: DeltaNetV01Connection | null;
};
export type UserNetworkingServerOptions = {
    legacyAdapterEnabled?: boolean;
    onClientConnect: (clientId: number, sessionToken: string, userIdentity?: UserData) => Promise<UserData | true | Error> | UserData | true | Error;
    onClientUserIdentityUpdate: (clientId: number, userIdentity: UserData) => Promise<UserData | null | false | true | Error> | UserData | null | false | true | Error;
    onClientDisconnect: (clientId: number) => void;
};
export declare class UserNetworkingServer {
    private options;
    private logger;
    private deltaNetServer;
    private authenticatedClientsById;
    private tickInterval;
    private legacyAdapter;
    private updatedUserProfilesInTick;
    constructor(options: UserNetworkingServerOptions, logger?: UserNetworkingLogger);
    getCharacterDescription(connectionId: number): LegacyCharacterDescription;
    getUsername(connectionId: number): string;
    getLegacyClientId(): number;
    hasCapacityForLegacyClient(): boolean;
    onLegacyClientConnect(id: number, sessionToken: string, userIdentity: LegacyUserIdentity | undefined): Promise<UserData | true | Error> | UserData | true | Error;
    setAuthenticatedLegacyClientConnection(clientId: number, webSocket: WebSocket, userData: UserData): void;
    onLegacyClientDisconnect(id: number): void;
    private handleStatesUpdate;
    private handleJoiner;
    private handleLeave;
    private handleCustomMessage;
    private handleDeltaNetAuthentication;
    connectClient(socket: WebSocket): void;
    broadcastMessage(broadcastType: number, broadcastPayload: string): void;
    updateUserCharacter(clientId: number, userData: UserData): void;
    updateUserUsername(clientId: number, username: string): void;
    updateUserCharacterDescription(clientId: number, characterDescription: CharacterDescription): void;
    updateUserColors(clientId: number, colors: Array<[number, number, number]>): void;
    updateUserStates(clientId: number, updates: UserData): void;
    private internalUpdateUser;
    dispose(clientCloseError?: UserNetworkingServerError): void;
}
//# sourceMappingURL=UserNetworkingServer.d.ts.map