import { DeltaNetV01ServerErrorType } from "@mml-io/delta-net-protocol";
import { DeltaNetV01Connection } from "./DeltaNetV01Connection";
export type onJoinerOptions = {
    deltaNetV01Connection: DeltaNetV01Connection;
    components: Array<[number, bigint]>;
    states: Array<[number, Uint8Array]>;
    token: string;
    internalConnectionId: number;
};
export type onComponentsUpdateOptions = {
    deltaNetV01Connection: DeltaNetV01Connection;
    internalConnectionId: number;
    components: Array<[number, bigint]>;
};
export type onStatesUpdateOptions = {
    deltaNetV01Connection: DeltaNetV01Connection;
    internalConnectionId: number;
    states: Array<[number, Uint8Array]>;
};
export type onLeaveOptions = {
    deltaNetV01Connection: DeltaNetV01Connection;
    internalConnectionId: number;
    components: Array<[number, number]>;
    states: Array<[number, Uint8Array]>;
};
export type onCustomMessageOptions = {
    deltaNetV01Connection: DeltaNetV01Connection;
    internalConnectionId: number;
    customType: number;
    contents: string;
};
export declare class DeltaNetServerError extends Error {
    errorType: DeltaNetV01ServerErrorType;
    retryable: boolean;
    constructor(errorType: DeltaNetV01ServerErrorType, message: string, retryable: boolean);
}
export type DeltaNetServerOptions = {
    onJoiner?: (opts: onJoinerOptions) => true | void | Error | DeltaNetServerError | {
        success: true;
        stateOverrides?: Array<[number, Uint8Array]>;
    } | Promise<true | void | Error | DeltaNetServerError | {
        success: true;
        stateOverrides?: Array<[number, Uint8Array]>;
    }>;
    onComponentsUpdate?: (opts: onComponentsUpdateOptions) => true | void | Error | DeltaNetServerError;
    onStatesUpdate?: (opts: onStatesUpdateOptions) => true | void | Error | DeltaNetServerError | {
        success: true;
        stateOverrides?: Array<[number, Uint8Array]>;
    } | Promise<true | void | Error | DeltaNetServerError | {
        success: true;
        stateOverrides?: Array<[number, Uint8Array]>;
    }>;
    onLeave?: (opts: onLeaveOptions) => void;
    onCustomMessage?: (opts: onCustomMessageOptions) => void;
    serverConnectionIdStateId?: number;
    maxStateValueSize?: number;
    maxMessageSize?: number;
};
export declare class DeltaNetServer {
    private opts;
    private currentConnectionId;
    private nextIndex;
    private preTickData;
    private connectionIdToComponentIndex;
    private componentIndexToConnectionId;
    private connectionIdToDeltaNetServerConnection;
    private allDeltaNetV01Connections;
    private authenticatedDeltaNetV01Connections;
    private observerConnections;
    private webSocketToDeltaNetServerConnection;
    private components;
    private states;
    private documentEffectiveStartTime;
    private pingCounter;
    private disposed;
    private maxStateValueSize;
    private maxMessageSize;
    constructor(opts?: DeltaNetServerOptions);
    static handleWebsocketSubprotocol(protocols: Set<string> | Array<string>): string | false;
    addWebSocket(webSocket: WebSocket): void;
    removeWebSocket(webSocket: WebSocket): void;
    hasWebSocket(webSocket: WebSocket): boolean;
    dangerouslyGetConnectionsToComponentIndex(): Map<number, number>;
    dangerouslyAddNewJoinerCallback(callback: (index: number) => {
        id: number;
        afterAddCallback?: () => void;
    } | null): void;
    private disconnectWithError;
    getComponentValue(componentId: number, componentIndex: number): number | null;
    getNextConnectionId(): number;
    getMaxMessageSize(): number;
    validateJoiner(deltaNetV01Connection: DeltaNetV01Connection, token: string, components: Array<[number, bigint]>, states: Array<[number, Uint8Array]>): Promise<{
        success: true;
    } | {
        success: false;
        error: string;
    }> | {
        success: true;
    } | {
        success: false;
        error: string;
    };
    addAuthenticatedConnection(deltaNetV01Connection: DeltaNetV01Connection): void;
    validateAndApplyStateUpdate(deltaNetV01Connection: DeltaNetV01Connection, internalConnectionId: number, stateId: number, stateValue: Uint8Array): Promise<true | void | Error | DeltaNetServerError> | true | void | Error | DeltaNetServerError;
    clearInternalConnectionId(internalConnectionId: number): void;
    private sendPings;
    tick(): {
        removedIds: Set<number>;
        addedIds: Set<number>;
    };
    getServerTime(): number;
    setUserComponents(deltaNetV01Connection: DeltaNetV01Connection, internalConnectionId: number, components: Array<[number, bigint]>): {
        success: true;
    } | {
        success: false;
        error: string;
    };
    setComponentValue(componentId: number, index: number, value: bigint): void;
    private applyComponentUpdates;
    overrideUserStates(deltaNetV01Connection: DeltaNetV01Connection | null, internalConnectionId: number, states: Array<[number, Uint8Array]>): void;
    setUserState(index: number, stateId: number, stateValue: Uint8Array): void;
    private applyStateUpdates;
    handleCustomMessage(deltaNetV01Connection: DeltaNetV01Connection, internalConnectionId: number, customType: number, contents: string): void;
    broadcastCustomMessage(customType: number, contents: string): void;
    dispose(): void;
}
//# sourceMappingURL=DeltaNetServer.d.ts.map